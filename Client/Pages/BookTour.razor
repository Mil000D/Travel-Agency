@page "/book-tour"
@inject HttpClient HttpClient
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar

<PageTitle>Book Tour</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium">
    <MudText Typo="Typo.h4" Class="mb-4">Book Tour</MudText>

    @if (tour != null)
    {
        <MudPaper Class="p-4">
            <MudText Typo="Typo.h6">@tour.Title</MudText>
            <MudText Typo="Typo.body1">Total Price: @tour.TotalPrice.ToString("C")</MudText>
            <MudDivider Class="my-2" Color="Color.Secondary" />
            <MudForm @ref="form" OnValidSubmit="HandleValidSubmit">
                <MudText Typo="Typo.h6">Payment Method</MudText>
                <MudSelect @bind-Value="purchase.PaymentMethod.Method" Label="Select Payment Method" Required="true">
                    <MudSelectItem Value="BLIK">BLIK</MudSelectItem>
                    <MudSelectItem Value="Cash">Cash</MudSelectItem>
                    <MudSelectItem Value="Card">Card</MudSelectItem>
                </MudSelect>
                    <MudButton Class="mt-4" Variant="Variant.Filled" Color="Color.Primary" @onclick="HandleValidSubmit">Submit</MudButton>
            </MudForm>
        </MudPaper>
    }
</MudContainer>

@code {
    [Parameter]
    public int TourId { get; set; }

    private TourDTO tour = new TourDTO { Id = 1, Title = "Golden Circle", TotalPrice = 1000 };
    private string BLIK = "BLIK";
    private string Cash = "Cash";
    private string Card = "Card";
    private CreatePurchaseDTO purchase = new CreatePurchaseDTO
    {
        PaymentMethod = new GetPaymentMethodDTO(),
        PaymentDate = DateTime.Now
    };
    private MudForm form;

    protected override async Task OnInitializedAsync()
    {

    }

    private async Task HandleValidSubmit()
    {
        Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomCenter;
        Snackbar.Add("Purchase successful!", Severity.Success);
        NavigationManager.NavigateTo("/booked-tours");
    }
}
